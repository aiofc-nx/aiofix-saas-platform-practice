# SAAS平台技术设计概述

## 📚 目录

### 🎯 技术设计概述

- [技术选型强制要求](#技术选型强制要求)
  - [日志系统强制要求](#1-日志系统强制要求)
  - [UUID 策略强制要求](#2-uuid-策略强制要求)
  - [HTTP 框架强制要求](#3-http-框架强制要求)
- [设计目标](#设计目标)
- [架构特点](#架构特点)
- [架构目标](#架构目标)
- [技术架构原则](#技术架构原则)
- [架构设计原则](#架构设计原则)

### 🛠️ 技术栈选择

- [后端技术栈](#后端技术栈)
- [开发工具](#开发工具)

### 📋 文档拆分说明

- [完整文档包含以下8个部分](#完整文档包含以下8个部分)
- [快速跳转到各文档](#快速跳转到各文档)

---

## 🎯 技术设计概述

### 技术选型强制要求

**开发者和AI必须严格遵循以下技术选型，不得违反**

#### 1. 日志系统强制要求

- **必须使用**: `PinoLoggerService` (来自 `@aiofix/logging`)
- **绝对禁止**: NestJS 内置的 `Logger`
- **违反后果**: 代码审查不通过，需要重新修改
- **原因**: 本系统自定义了 Logger，集成了 Pino，以 PinoLoggerService 对外提供日志服务

#### 2. UUID 策略强制要求

- **必须使用**: `uuid v4`
- **绝对禁止**: 其他版本的 UUID、自增 ID、时间戳等
- **违反后果**: 代码审查不通过，需要重新修改
- **原因**: 本系统全局统一使用 uuid v4 作为所有实体的唯一标识符

#### 3. HTTP 框架强制要求

- **必须使用**: `Fastify` (来自 `@nestjs/platform-fastify`)
- **绝对禁止**: `Express` 及其相关包
- **违反后果**: 代码审查不通过，需要重新修改
- **原因**: 本系统全局统一使用 Fastify 作为 HTTP 框架，以获得更好的性能和类型安全

### 设计目标

基于业务需求文档，设计一个高性能、可扩展、安全的 SAAS 平台，支持多租户、多组织、多部门的复杂业务场景。平台将平台、租户、组织、部门、用户、认证授权等领域作为核心功能，同时将侧重于业务领域的平台、租户、组织、部门、用户与认证授权分离，确保职责清晰。为今后横向扩展增加其他业务领域模块，例如：人力资源、财务管理、进销存、客户关系管理、AI拓展等奠定坚实的基础。

### 架构特点

- **单体应用优先**：采用单体应用架构，便于开发和维护
- **模块化设计**：通过模块化设计实现高内聚低耦合
- **可扩展性**：为未来微服务化预留接口和设计空间
- **技术栈简化**：避免过度设计，选择必要的技术组件

### 架构目标

SAAS平台的领域架构，实现：

1. **职责清晰**：每个模块都有明确的业务边界
2. **高内聚低耦合**：模块内部高内聚，模块间低耦合
3. **可复用性**：基础模块可以被多个业务场景复用
4. **可扩展性**：每个模块可以独立演进和扩展
5. **团队协作友好**：不同团队可以专注不同模块

### 技术架构原则

项目采用混合架构，技术栈包括：Clean Architecture + RESTful API + CQRS + GraphQL + 事件溯源 + 多数据库支持 + 单体应用架构

1. **分层架构**: 遵循 Clean Architecture 分层设计
2. **领域驱动**: 基于 DDD 思想进行领域建模
3. **CQRS 模式**: 命令查询职责分离
4. **GraphQL 支持**: 灵活查询和数据获取
5. **事件溯源**: 采用 Event Sourcing 模式
6. **多数据库**: 支持 PostgreSQL 和 MongoDB
7. **数据隔离**: 完整的多层级数据隔离策略
8. **访问控制**: 基于隔离级别和隐私级别的细粒度访问控制
9. **高性能**: 支持百万级用户和复杂权限场景
10. **高安全**: 多层次安全防护机制
11. **核心功能分离**: 将业务管理领域（平台、租户、组织、部门、用户）与认证授权领域分离，确保职责清晰
12. **目录结构设计**: 遵循领域驱动设计（DDD）思想，代码目录架构应当首先体现领域的边界

### 架构设计原则

```
架构设计原则：
1. 单一职责原则：每个模块只负责一个明确的业务领域
2. 高内聚低耦合：模块内部高内聚，模块间低耦合
3. 领域驱动设计：按业务领域划分，而不是按技术层次划分
4. 可复用性：模块可以被多个业务场景复用
5. 可扩展性：模块可以独立演进和扩展
6. 团队协作友好：不同团队可以专注不同模块
```

### 技术栈选择

#### 后端技术栈

- **语言**: TypeScript 5.x
- **框架**: NestJS 11.x + Fastify (HTTP 框架)
- **数据库**: PostgreSQL 15.x (命令端 + 事件存储) + MongoDB 7.x (查询端)
- **缓存**: Redis 7.x
- **ORM**: MikroORM
- **认证**: Passport.js + JWT
- **权限控制**: CASL

#### 开发工具

- **包管理**: pnpm
- **构建工具**: pnpm workspace
- **代码规范**: ESLint + Prettier
- **测试框架**: Jest
- **API 文档**: Swagger/OpenAPI

## 📋 文档拆分说明

本文档是SAAS平台技术设计文档的第一部分，主要包含：

1. **技术选型强制要求** - 必须严格遵守的技术规范
2. **设计目标** - 系统的整体设计目标
3. **架构特点** - 系统架构的核心特点
4. **架构目标** - 领域架构的具体目标
5. **技术架构原则** - 技术架构的设计原则
6. **架构设计原则** - 架构设计的基本原则
7. **技术栈选择** - 具体的技术选型

**完整文档包含以下8个部分**：

### 快速跳转到各文档

1. **[SAAS平台技术设计概述](./saas-technical-design-overview.md)** (本文档) - 技术选型、设计目标、架构原则
2. **[SAAS平台系统架构设计](./saas-system-architecture.md)** - 系统架构、领域模块、目录结构
3. **[SAAS平台Clean Architecture设计](./saas-clean-architecture.md)** - Clean Architecture、CQRS、事件溯源
4. **[SAAS平台安全架构与数据隔离](./saas-security-data-isolation.md)** - 安全架构、数据隔离、访问控制
5. **[SAAS平台数据模型与GraphQL](./saas-data-model-graphql.md)** - 数据模型、数据库设计、GraphQL
6. **[SAAS平台性能优化与部署](./saas-performance-optimization.md)** - 性能优化、缓存策略、部署架构
7. **[SAAS平台测试策略与架构](./saas-testing-strategy.md)** - 测试策略、验证方法、CI/CD
8. **[SAAS平台开发指南与最佳实践](./saas-development-guide.md)** - 开发指南、最佳实践、代码规范

---

**文档版本**: v1.0.0  
**创建日期**: 2024-12-19  
**适用范围**: SAAS平台技术设计指导
