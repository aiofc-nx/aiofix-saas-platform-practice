---
description: ç³»ç»Ÿæ¶æ„ä¸ä»£ç ç»„ç»‡æ¶æ„
globs:
alwaysApply: true
---

# ç³»ç»Ÿæ¶æ„ä¸ä»£ç ç»„ç»‡æ¶æ„åŸåˆ™

æœ¬é¡¹ç›®çš„ç›®æ ‡æ˜¯å¼€å‘ä¸€ä¸ªä¼ä¸šçº§çš„ SAAS å¹³å°ï¼Œéµå¾ªæ•´æ´æ¶æ„ï¼ˆClean Architectureï¼‰å’Œé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰çš„æ€æƒ³å’ŒåŸåˆ™ã€‚
é¡¹ç›®é‡‡ç”¨æ··åˆæ¶æ„ï¼ŒæŠ€æœ¯æ ˆåŒ…æ‹¬ï¼šClean Architecture + RESTful API + CQRS + GraphQL + äº‹ä»¶æº¯æº + å¤šæ•°æ®åº“æ”¯æŒ

## ğŸ—ï¸ æ•´ä½“æ¶æ„æ¨¡å¼

### SaaS å¹³å°æ¶æ„ç‰¹å¾

```
HL8 SaaS å¹³å°
â”œâ”€â”€ å¤šç§Ÿæˆ·ï¼ˆä¸‹è®¾ç»„ç»‡åŠéƒ¨é—¨ï¼‰æ¶æ„ (Multi-Tenant)
â”‚   â”œâ”€â”€ å¤šå±‚çº§æ•°æ®éš”ç¦»ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ å¹³å°çº§éš”ç¦» (Platform Level)
â”‚   â”‚   â”œâ”€â”€ ç§Ÿæˆ·çº§éš”ç¦» (Tenant Level)
â”‚   â”‚   â”œâ”€â”€ ç»„ç»‡çº§éš”ç¦» (Organization Level)
â”‚   â”‚   â”œâ”€â”€ éƒ¨é—¨çº§éš”ç¦» (Department Level)
â”‚   â”‚   â”œâ”€â”€ å­éƒ¨é—¨çº§éš”ç¦» (Sub-Department Level)
â”‚   â”‚   â””â”€â”€ ç”¨æˆ·çº§éš”ç¦» (User Level - è·¨å±‚çº§å­˜åœ¨)
â”‚   â”œâ”€â”€ æ•°æ®éšç§çº§åˆ«æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ å¯å…±äº«æ•°æ® (Shared Data)
â”‚   â”‚   â””â”€â”€ å—ä¿æŠ¤æ•°æ® (Protected Data)
â”‚   â”œâ”€â”€ æ•°æ®è®¿é—®æ§åˆ¶æœºåˆ¶
â”‚   â”‚   â”œâ”€â”€ åŸºäºéš”ç¦»çº§åˆ«çš„è®¿é—®æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ åŸºäºéšç§çº§åˆ«çš„è®¿é—®æ§åˆ¶
â”‚   â”‚   â””â”€â”€ è·¨å±‚çº§è®¿é—®æ§åˆ¶
â”‚   â”œâ”€â”€ èµ„æºé…é¢ç®¡ç†
â”‚   â””â”€â”€ è®¡è´¹ä¸è®¢é˜…ç®¡ç†
â”œâ”€â”€ å•ä½“åº”ç”¨æ¶æ„ä¼˜å…ˆ+å…¼å®¹å¾®æœåŠ¡æ¶æ„ (Microservices)
â”‚   â”œâ”€â”€ æœåŠ¡æ‹†åˆ†ç­–ç•¥ï¼ˆæ¨¡å—åŒ–ç‹¬ç«‹ä¾èµ–åŒ…ï¼‰
â”‚   â”œâ”€â”€ å•ä½“åº”ç”¨æœåŠ¡é›†æˆç­–ç•¥
â”œâ”€â”€ CQRS + äº‹ä»¶æº¯æºæ¶æ„ (CQRS + Event Sourcing)
â”‚   â”œâ”€â”€ å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦» (CQRS)
â”‚   â”œâ”€â”€ äº‹ä»¶æº¯æº (Event Sourcing)
â”‚   â”œâ”€â”€ è¯»æ¨¡å‹æŠ•å½± (Read Model Projections)
â”‚   â””â”€â”€ çŠ¶æ€é‡å»ºèƒ½åŠ›
â””â”€â”€ äº‘åŸç”Ÿæ¶æ„ (Cloud-Native)
    â”œâ”€â”€ å®¹å™¨åŒ–éƒ¨ç½²
    â”œâ”€â”€ å¼¹æ€§ä¼¸ç¼©
    â””â”€â”€ å¯è§‚æµ‹æ€§
```

### Clean Architecture åˆ†å±‚è®¾è®¡

```
Clean Architecture å››å±‚æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Presentation Layer (è¡¨ç°å±‚)      â”‚  â† REST APIã€GraphQLã€WebSocket
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Application Layer (åº”ç”¨å±‚)       â”‚  â† Use Casesã€Commandsã€Queriesã€Handlersã€Data Access Control
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       Domain Layer (é¢†åŸŸå±‚)         â”‚  â† Entitiesã€Value Objectsã€Aggregatesã€Domain Eventsã€Data Isolation Aware
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)  â”‚  â† æ•°æ®åº“ã€ç¼“å­˜ã€äº‹ä»¶å­˜å‚¨ã€å¤–éƒ¨æœåŠ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å„å±‚ä¹‹é—´ä¾èµ–æ–¹å‘åªèƒ½æŒ‡å‘å†…å±‚ï¼Œå¤–å±‚ä¸å¾—ä¾èµ–å†…å±‚å®ç°ç»†èŠ‚ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚**

**å„é¢†åŸŸæ¨¡å—éœ€è¦å…±äº«çš„ç»„ä»¶æˆ‘ä»¬ç»Ÿä¸€æŠ½ç¦»å‡ºæ¥ï¼Œä»¥ç‹¬ç«‹æ¨¡å—çš„å½¢å¼å¼€å‘ï¼Œä½œä¸º shared é¢†åŸŸæ¨¡å—ï¼Œå„é¢†åŸŸæ¨¡å—ä¸å†åˆ›å»ºå…±äº«é¢†åŸŸå±‚ã€‚**

## ğŸ¯ æ ¸å¿ƒæ¶æ„æ¨¡å¼

### RESTful + CQRS + GraphQL + äº‹ä»¶æº¯æº

æˆ‘ä»¬çš„ç³»ç»Ÿé‡‡ç”¨å››ç§æ ¸å¿ƒæ¶æ„æ¨¡å¼çš„ç»„åˆï¼š

#### 1. **RESTful API** - å‘½ä»¤æ¥å£

- **èŒè´£**: å¤„ç†å†™æ“ä½œå’Œç®€å•æŸ¥è¯¢
- **ç‰¹ç‚¹**: ç®€å•ç›´æ¥ã€æ ‡å‡†åŒ–ã€æ˜“äºç†è§£
- **é€‚ç”¨åœºæ™¯**: ç”¨æˆ·åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€è®¤è¯æ“ä½œ

#### 2. **CQRS** - è¯»å†™åˆ†ç¦»

- **èŒè´£**: å‘½ä»¤ç«¯å¤„ç†å†™æ“ä½œï¼ŒæŸ¥è¯¢ç«¯å¤„ç†è¯»æ“ä½œ
- **ç‰¹ç‚¹**: æ€§èƒ½ä¼˜åŒ–ã€å¯æ‰©å±•æ€§ã€èŒè´£æ¸…æ™°
- **é€‚ç”¨åœºæ™¯**: é«˜å¹¶å‘è¯»å†™åœºæ™¯ã€å¤æ‚æŸ¥è¯¢ä¼˜åŒ–

#### 3. **GraphQL** - çµæ´»æŸ¥è¯¢

- **èŒè´£**: å¤„ç†å¤æ‚æŸ¥è¯¢å’Œå…³è”æ•°æ®
- **ç‰¹ç‚¹**: çµæ´»æŸ¥è¯¢ã€å‡å°‘ç½‘ç»œè¯·æ±‚ã€ç±»å‹å®‰å…¨
- **é€‚ç”¨åœºæ™¯**: å¤æ‚æ•°æ®æŸ¥è¯¢ã€å‰ç«¯æ•°æ®è·å–ä¼˜åŒ–

#### 4. **äº‹ä»¶æº¯æº** - çŠ¶æ€ç®¡ç†

- **èŒè´£**: çŠ¶æ€å˜æ›´è®°å½•ã€å®¡è®¡è¿½è¸ªã€çŠ¶æ€é‡å»º
- **ç‰¹ç‚¹**: å®Œæ•´å†å²è®°å½•ã€å¯è¿½æº¯æ€§ã€çŠ¶æ€ä¸€è‡´æ€§
- **é€‚ç”¨åœºæ™¯**: ä¸šåŠ¡å®¡è®¡ã€çŠ¶æ€é‡å»ºã€æ•°æ®ä¸€è‡´æ€§

### æ¶æ„åä½œå…³ç³»

```
å‰ç«¯åº”ç”¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Presentation Layer        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RESTful API â”‚  â”‚   GraphQL   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Layer           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Use Cases  â”‚  â”‚ Commands    â”‚  â”‚
â”‚  â”‚             â”‚  â”‚ Queries     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Handlers   â”‚  â”‚ Projections â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Data Access  â”‚  â”‚ Validators  â”‚  â”‚
â”‚  â”‚  Control    â”‚  â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Domain Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Aggregates  â”‚  â”‚  Entities   â”‚  â”‚
â”‚  â”‚ Domain Evt  â”‚  â”‚ Value Objs  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Data Isolationâ”‚ â”‚ Domain Svc  â”‚  â”‚
â”‚  â”‚   Aware     â”‚  â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Infrastructure Layer         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚  MongoDB    â”‚  â”‚
â”‚  â”‚ (Commands)  â”‚  â”‚ (Queries)   â”‚  â”‚
â”‚  â”‚ Event Store â”‚  â”‚ Read Models â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµç¤ºä¾‹

#### å¹³å°ç”¨æˆ·åˆ›å»ºæµç¨‹

1. **å‰ç«¯** â†’ RESTful API (`POST /api/platform/users`)
2. **Use Case** â†’ `CreatePlatformUserUseCase.execute()`
3. **æ•°æ®è®¿é—®æ§åˆ¶** â†’ `DataAccessControlService.checkAccess()`
4. **å‘½ä»¤** â†’ `CreatePlatformUserCommand`
5. **å‘½ä»¤å¤„ç†å™¨** â†’ `CreatePlatformUserHandler.execute()`
6. **èšåˆæ ¹** â†’ `PlatformUserAggregate.create()`
7. **é¢†åŸŸå®ä½“** â†’ `PlatformUserEntity` (å¹³å°çº§å®ä½“)
8. **é¢†åŸŸäº‹ä»¶** â†’ `PlatformUserCreatedEvent` (åŒ…å«å¹³å°çº§æ•°æ®éš”ç¦»ä¿¡æ¯)
9. **äº‹ä»¶å­˜å‚¨** â†’ ä¿å­˜äº‹ä»¶åˆ° PostgreSQL
10. **æŠ•å½±** â†’ æ›´æ–°è¯»æ¨¡å‹åˆ° MongoDB

#### ç§Ÿæˆ·ç”¨æˆ·åˆ›å»ºæµç¨‹

1. **å‰ç«¯** â†’ RESTful API (`POST /api/tenants/{tenantId}/users`)
2. **Use Case** â†’ `CreateTenantUserUseCase.execute()`
3. **æ•°æ®è®¿é—®æ§åˆ¶** â†’ `DataAccessControlService.checkAccess()`
4. **å‘½ä»¤** â†’ `CreateTenantUserCommand`
5. **å‘½ä»¤å¤„ç†å™¨** â†’ `CreateTenantUserHandler.execute()`
6. **èšåˆæ ¹** â†’ `TenantUserAggregate.create()`
7. **é¢†åŸŸå®ä½“** â†’ `TenantUserEntity` (æ•°æ®éš”ç¦»æ„ŸçŸ¥å®ä½“)
8. **é¢†åŸŸäº‹ä»¶** â†’ `TenantUserCreatedEvent` (åŒ…å«æ•°æ®éš”ç¦»ä¿¡æ¯)
9. **äº‹ä»¶å­˜å‚¨** â†’ ä¿å­˜äº‹ä»¶åˆ° PostgreSQL
10. **æŠ•å½±** â†’ æ›´æ–°è¯»æ¨¡å‹åˆ° MongoDB

#### å¹³å°ç”¨æˆ·æŸ¥è¯¢æµç¨‹

1. **å‰ç«¯** â†’ GraphQL Query (`platformUser(id: "123")`)
2. **Use Case** â†’ `GetPlatformUserUseCase.execute()`
3. **æ•°æ®è®¿é—®æ§åˆ¶** â†’ `DataAccessControlService.checkAccess()`
4. **æŸ¥è¯¢** â†’ `GetPlatformUserByIdQuery`
5. **æŸ¥è¯¢å¤„ç†å™¨** â†’ `GetPlatformUserByIdHandler.execute()`
6. **è¯»æ¨¡å‹** â†’ ä» MongoDB è·å–æ•°æ®ï¼ˆåŒ…å«å¹³å°çº§æ•°æ®éš”ç¦»ä¿¡æ¯ï¼‰
7. **æ•°æ®éš”ç¦»éªŒè¯** â†’ éªŒè¯å¹³å°ç”¨æˆ·è®¿é—®æƒé™
8. **GraphQL Resolver** â†’ ç»„è£…å…³è”æ•°æ®
9. **å‰ç«¯** â†’ è·å–å®Œæ•´çš„å¹³å°ç”¨æˆ·ä¿¡æ¯

#### ç§Ÿæˆ·ç”¨æˆ·æŸ¥è¯¢æµç¨‹

1. **å‰ç«¯** â†’ GraphQL Query (`tenantUser(id: "123")`)
2. **Use Case** â†’ `GetTenantUserUseCase.execute()`
3. **æ•°æ®è®¿é—®æ§åˆ¶** â†’ `DataAccessControlService.checkAccess()`
4. **æŸ¥è¯¢** â†’ `GetTenantUserByIdQuery`
5. **æŸ¥è¯¢å¤„ç†å™¨** â†’ `GetTenantUserByIdHandler.execute()`
6. **è¯»æ¨¡å‹** â†’ ä» MongoDB è·å–æ•°æ®ï¼ˆåŒ…å«æ•°æ®éš”ç¦»ä¿¡æ¯ï¼‰
7. **æ•°æ®éš”ç¦»éªŒè¯** â†’ éªŒè¯ç§Ÿæˆ·ç”¨æˆ·è®¿é—®æƒé™
8. **GraphQL Resolver** â†’ ç»„è£…å…³è”æ•°æ®
9. **å‰ç«¯** â†’ è·å–å®Œæ•´çš„ç§Ÿæˆ·ç”¨æˆ·ä¿¡æ¯

## ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

### Use Case è®¾è®¡åŸåˆ™

```typescript
// Use Case æ˜¯ä¸šåŠ¡é€»è¾‘çš„ç»Ÿä¸€å…¥å£
@Injectable()
export class CreateUserUseCase {
  constructor(
    private readonly commandBus: CommandBus,
    private readonly userRepository: UserRepository,
    private readonly emailService: EmailService,
    private readonly auditService: AuditService
  ) {}

  async execute(request: CreateUserRequest): Promise<CreateUserResponse> {
    // 1. ä¸šåŠ¡è§„åˆ™éªŒè¯
    await this.validateBusinessRules(request);

    // 2. åˆ›å»ºå‘½ä»¤
    const command = new CreateUserCommand(
      request.username,
      request.email,
      request.password,
      request.tenantId
    );

    // 3. æ‰§è¡Œå‘½ä»¤
    await this.commandBus.execute(command);

    // 4. ä¸šåŠ¡é€»è¾‘å¤„ç†
    await this.sendWelcomeEmail(request.email);
    await this.auditService.logUserCreation(request);

    return { userId: command.userId, success: true };
  }

  private async validateBusinessRules(
    request: CreateUserRequest
  ): Promise<void> {
    // ä¸šåŠ¡è§„åˆ™éªŒè¯é€»è¾‘
  }
}
```

### é¢†åŸŸæ¨¡å‹åˆ†å±‚è®¾è®¡

```typescript
// 1. èšåˆæ ¹ (Aggregate Root) - ä¸šåŠ¡è§„åˆ™å’Œä¸€è‡´æ€§è¾¹ç•Œ
export class UserAggregate {
  private user: UserEntity;
  private uncommittedEvents: DomainEvent[] = [];

  static create(
    username: string,
    email: string,
    password: string,
    tenantId: Uuid,
    organizationId?: Uuid,
    departmentIds: Uuid[] = [],
    dataPrivacyLevel: DataPrivacyLevel = DataPrivacyLevel.PROTECTED
  ): UserAggregate {
    const aggregate = new UserAggregate();
    const userId = UserId.generate();

    // åˆ›å»ºç”¨æˆ·å®ä½“ï¼ˆæ•°æ®éš”ç¦»æ„ŸçŸ¥ï¼‰
    aggregate.user = UserEntity.create(
      userId,
      username,
      email,
      tenantId,
      organizationId,
      departmentIds,
      dataPrivacyLevel
    );

    // åº”ç”¨ä¸šåŠ¡è§„åˆ™
    aggregate.applyPasswordPolicy(password);

    // äº§ç”Ÿé¢†åŸŸäº‹ä»¶ï¼ˆåŒ…å«æ•°æ®éš”ç¦»ä¿¡æ¯ï¼‰
    aggregate.apply(
      new UserCreatedEvent(
        userId,
        username,
        email,
        tenantId,
        organizationId,
        departmentIds,
        DataIsolationLevel.USER,
        dataPrivacyLevel
      )
    );

    return aggregate;
  }

  changeEmail(newEmail: EmailValueObject): void {
    // ä¸šåŠ¡è§„åˆ™éªŒè¯
    if (this.user.email.equals(newEmail)) {
      return;
    }

    // æ›´æ–°å®ä½“
    this.user.changeEmail(newEmail);

    // äº§ç”Ÿé¢†åŸŸäº‹ä»¶
    this.apply(
      new UserEmailChangedEvent(this.user.id, this.user.email, newEmail)
    );
  }

  private applyPasswordPolicy(password: string): void {
    // å¯†ç ç­–ç•¥ä¸šåŠ¡è§„åˆ™
  }
}

// 2. å®ä½“ (Entity) - ä¸šåŠ¡å®ä½“ï¼Œæœ‰æ ‡è¯†ï¼Œæ•°æ®éš”ç¦»æ„ŸçŸ¥
export class UserEntity extends DataIsolationAwareEntity {
  private username: UsernameValueObject;
  private email: EmailValueObject;
  private status: UserStatus;

  constructor(
    id: UserId,
    username: string,
    email: string,
    tenantId: Uuid,
    organizationId?: Uuid,
    departmentIds: Uuid[] = [],
    dataPrivacyLevel: DataPrivacyLevel = DataPrivacyLevel.PROTECTED
  ) {
    super(
      tenantId,
      DataIsolationLevel.USER,
      dataPrivacyLevel,
      id,
      organizationId,
      departmentIds,
      id // userId ä¸å®ä½“IDç›¸åŒ
    );
    this.username = new UsernameValueObject(username);
    this.email = new EmailValueObject(email);
    this.status = UserStatus.ACTIVE;
  }

  static create(
    id: UserId,
    username: string,
    email: string,
    tenantId: Uuid,
    organizationId?: Uuid,
    departmentIds: Uuid[] = [],
    dataPrivacyLevel: DataPrivacyLevel = DataPrivacyLevel.PROTECTED
  ): UserEntity {
    return new UserEntity(
      id,
      username,
      email,
      tenantId,
      organizationId,
      departmentIds,
      dataPrivacyLevel
    );
  }

  changeEmail(newEmail: EmailValueObject): void {
    this.email = newEmail;
  }

  // æ•°æ®è®¿é—®æ§åˆ¶æ–¹æ³•
  canAccess(target: DataIsolationAwareEntity): boolean {
    return super.canAccess(target);
  }

  // Getters
  get id(): UserId {
    return this.id;
  }
  get username(): UsernameValueObject {
    return this.username;
  }
  get email(): EmailValueObject {
    return this.email;
  }
  get status(): UserStatus {
    return this.status;
  }
}

// 3. å€¼å¯¹è±¡ (Value Object) - ä¸å¯å˜å¯¹è±¡
export class EmailValueObject {
  constructor(private readonly value: string) {
    this.validate();
  }

  private validate(): void {
    if (!isValidEmail(this.value)) {
      throw new InvalidEmailException(this.value);
    }
  }

  equals(other: EmailValueObject): boolean {
    return this.value === other.value;
  }

  toString(): string {
    return this.value;
  }
}
```

### ä¾èµ–å…³ç³»åŸåˆ™

```
ä¾èµ–æ–¹å‘ (Dependency Direction)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Presentation Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Controllers â”‚  â”‚  Resolvers  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Application Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Use Cases  â”‚  â”‚  Handlers   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Data Access  â”‚  â”‚ Validators  â”‚  â”‚
â”‚  â”‚  Control    â”‚  â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Domain Layer                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Aggregates  â”‚  â”‚  Entities   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Data Isolationâ”‚ â”‚ Value Objs  â”‚  â”‚
â”‚  â”‚   Aware     â”‚  â”‚             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â†“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Infrastructure Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Repositoriesâ”‚  â”‚   Services  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®åŸåˆ™**ï¼š

- å¤–å±‚åªèƒ½ä¾èµ–å†…å±‚
- å†…å±‚ä¸èƒ½ä¾èµ–å¤–å±‚
- Use Case æ˜¯ä¸šåŠ¡é€»è¾‘çš„ç»Ÿä¸€å…¥å£
- èšåˆæ ¹ç®¡ç†ä¸šåŠ¡è§„åˆ™å’Œä¸€è‡´æ€§
- å®ä½“å’Œå€¼å¯¹è±¡åˆ†ç¦»ï¼ŒèŒè´£æ¸…æ™°
- æ•°æ®éš”ç¦»æ„ŸçŸ¥å®ä½“è´Ÿè´£æ•°æ®è®¿é—®æ§åˆ¶
- åº”ç”¨å±‚æ•°æ®è®¿é—®æ§åˆ¶æœåŠ¡è´Ÿè´£æƒé™éªŒè¯

### é«˜æ€§èƒ½ç­–ç•¥

```
æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
â”œâ”€â”€ ç¼“å­˜ç­–ç•¥
â”‚   â”œâ”€â”€ Rediså¤šçº§ç¼“å­˜
â”‚   â”œâ”€â”€ æŸ¥è¯¢ç»“æœç¼“å­˜
â”‚   â”œâ”€â”€ æƒé™ç¼“å­˜
â”‚   â”œâ”€â”€ æ•°æ®éš”ç¦»ç¼“å­˜
â”‚   â””â”€â”€ ä¼šè¯ç¼“å­˜
â”œâ”€â”€ æ•°æ®åº“ä¼˜åŒ–
â”‚   â”œâ”€â”€ è¯»å†™åˆ†ç¦»
â”‚   â”œâ”€â”€ åˆ†åº“åˆ†è¡¨
â”‚   â”œâ”€â”€ ç´¢å¼•ä¼˜åŒ–
â”‚   â”œâ”€â”€ æ•°æ®éš”ç¦»ç´¢å¼•
â”‚   â””â”€â”€ æŸ¥è¯¢ä¼˜åŒ–
â”œâ”€â”€ å¼‚æ­¥å¤„ç†
â”‚   â”œâ”€â”€ äº‹ä»¶æŠ•å½±
â”‚   â”œâ”€â”€ è¯»æ¨¡å‹æ›´æ–°
â”‚   â”œâ”€â”€ åå°ä»»åŠ¡
â”‚   â””â”€â”€ æ‰¹é‡å¤„ç†
â”œâ”€â”€ æ•°æ®éš”ç¦»ä¼˜åŒ–
â”‚   â”œâ”€â”€ ç§Ÿæˆ·çº§ç¼“å­˜éš”ç¦»
â”‚   â”œâ”€â”€ ç»„ç»‡çº§æŸ¥è¯¢ä¼˜åŒ–
â”‚   â”œâ”€â”€ éƒ¨é—¨çº§æ•°æ®åˆ†åŒº
â”‚   â””â”€â”€ ç”¨æˆ·çº§è®¿é—®æ§åˆ¶ç¼“å­˜
â””â”€â”€ CDNä¸å‹ç¼©
    â”œâ”€â”€ é™æ€èµ„æºCDN
    â”œâ”€â”€ APIå“åº”å‹ç¼©
    â”œâ”€â”€ å›¾ç‰‡å‹ç¼©
    â””â”€â”€ æ–‡ä»¶å‹ç¼©
```

## ğŸ”„ å¼€å‘æµç¨‹ä¸æ¶æ„

### CQRS ç›®å½•ç»“æ„æœ€ä½³å®è·µ

#### åº”ç”¨å±‚ç›®å½•ç»„ç»‡åŸåˆ™

```
application/
â”œâ”€â”€ use-cases/          # ç”¨ä¾‹ (ä¸šåŠ¡é€»è¾‘å…¥å£)
â”œâ”€â”€ commands/           # å‘½ä»¤ (å†™æ“ä½œ)
â”‚   â”œâ”€â”€ handlers/      # å‘½ä»¤å¤„ç†å™¨
â”‚   â””â”€â”€ validators/    # å‘½ä»¤éªŒè¯å™¨
â”œâ”€â”€ queries/           # æŸ¥è¯¢ (è¯»æ“ä½œ)
â”‚   â”œâ”€â”€ handlers/      # æŸ¥è¯¢å¤„ç†å™¨
â”‚   â””â”€â”€ validators/    # æŸ¥è¯¢éªŒè¯å™¨
â”œâ”€â”€ projections/       # è¯»æ¨¡å‹æŠ•å½±
â”œâ”€â”€ services/          # åº”ç”¨æœåŠ¡
â””â”€â”€ interfaces/        # åº”ç”¨å±‚æ¥å£
```

**è®¾è®¡åŸåˆ™**ï¼š
- **å‘½ä»¤å’ŒæŸ¥è¯¢åˆ†ç¦»**ï¼šå†™æ“ä½œå’Œè¯»æ“ä½œå®Œå…¨åˆ†ç¦»
- **å¤„ç†å™¨å°±è¿‘åŸåˆ™**ï¼šhandlersæ”¾åœ¨å¯¹åº”çš„commands/queriesç›®å½•ä¸‹
- **éªŒè¯å™¨åˆ†ç¦»**ï¼šæ¯ä¸ªå‘½ä»¤/æŸ¥è¯¢éƒ½æœ‰å¯¹åº”çš„éªŒè¯å™¨
- **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªç›®å½•éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ

### Clean Architecture + CQRS + äº‹ä»¶æº¯æº + GraphQL + æ•°æ®éš”ç¦» æ¨¡å¼

```typescript
// ä¸šåŠ¡é€»è¾‘é€šè¿‡ Use Case ç»Ÿä¸€è°ƒç”¨ CQRSï¼Œé›†æˆæ•°æ®éš”ç¦»æ§åˆ¶
Presentation Layer          Application Layer
     â†“                           â†“
[REST API] â†’ [Use Case] â†’ [Data Access Control] â†’ [Command/Query] â†’ [Handler]
[GraphQL] â†’ [Use Case] â†’ [Data Access Control] â†’ [Command/Query] â†’ [Handler]
     â†“                           â†“
Domain Layer              Infrastructure Layer
[Aggregate] â†â†’ [Data Isolation Aware Entity] â†â†’ [Repository] â†â†’ [Database]
[Domain Event] â†â†’ [Event Store] â†â†’ [Projection]
```

### Clean Architecture å¼€å‘æµç¨‹

```
Clean Architecture å¼€å‘æµç¨‹
1. ä¸šåŠ¡éœ€æ±‚ â†’ 2. Use Case å®šä¹‰ â†’ 3. æ•°æ®è®¿é—®æ§åˆ¶ â†’ 4. å‘½ä»¤/æŸ¥è¯¢ â†’ 5. å¤„ç†å™¨
                        â†“
9. å‰ç«¯å“åº” â† 8. æ•°æ®è¿”å› â† 7. è¯»æ¨¡å‹æŠ•å½± â† 6. äº‹ä»¶å­˜å‚¨
```

### é¢†åŸŸæ¨¡å‹è®¾è®¡åŸåˆ™

```
é¢†åŸŸæ¨¡å‹åˆ†å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Aggregate (èšåˆæ ¹)         â”‚  â† ä¸šåŠ¡è§„åˆ™ã€ä¸€è‡´æ€§è¾¹ç•Œ
â”‚  â”œâ”€â”€ PlatformUserAggregate         â”‚  â† å¹³å°ç”¨æˆ·èšåˆæ ¹
â”‚  â”œâ”€â”€ TenantUserAggregate           â”‚  â† ç§Ÿæˆ·ç”¨æˆ·èšåˆæ ¹
â”‚  â”œâ”€â”€ TenantAggregate               â”‚  â† ç§Ÿæˆ·èšåˆæ ¹
â”‚  â””â”€â”€ OrganizationAggregate         â”‚  â† ç»„ç»‡èšåˆæ ¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Entity (å®ä½“)             â”‚  â† ä¸šåŠ¡å®ä½“ã€æ ‡è¯†
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   PlatformEntity               â”‚ â”‚  â† å¹³å°çº§å®ä½“åŸºç±»
â”‚  â”‚   â”œâ”€â”€ PlatformUserEntity       â”‚ â”‚  â† å¹³å°ç”¨æˆ·å®ä½“
â”‚  â”‚   â”œâ”€â”€ PlatformConfigEntity     â”‚ â”‚  â† å¹³å°é…ç½®å®ä½“
â”‚  â”‚   â””â”€â”€ SystemConfigEntity       â”‚ â”‚  â† ç³»ç»Ÿé…ç½®å®ä½“
â”‚  â”‚   DataIsolationAwareEntity     â”‚ â”‚  â† æ•°æ®éš”ç¦»æ„ŸçŸ¥å®ä½“åŸºç±»
â”‚  â”‚   â”œâ”€â”€ TenantUserEntity         â”‚ â”‚  â† ç§Ÿæˆ·ç”¨æˆ·å®ä½“
â”‚  â”‚   â”œâ”€â”€ TenantEntity             â”‚ â”‚  â† ç§Ÿæˆ·å®ä½“
â”‚  â”‚   â”œâ”€â”€ OrganizationEntity       â”‚ â”‚  â† ç»„ç»‡å®ä½“
â”‚  â”‚   â””â”€â”€ DepartmentEntity         â”‚ â”‚  â† éƒ¨é—¨å®ä½“
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Value Object (å€¼å¯¹è±¡)        â”‚  â† ä¸å¯å˜å¯¹è±¡ã€ä¸šåŠ¡æ¦‚å¿µ
â”‚  â”œâ”€â”€ UserId, TenantId              â”‚  â† æ ‡è¯†å€¼å¯¹è±¡
â”‚  â”œâ”€â”€ Username, Email, Password     â”‚  â† ä¸šåŠ¡å€¼å¯¹è±¡
â”‚  â””â”€â”€ TenantDomain, TenantName      â”‚  â† ç§Ÿæˆ·å€¼å¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„æ ˆ

### åç«¯æŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒæ¡†æ¶ä¸è¯­è¨€
- è¯­è¨€: TypeScript 5.x
- æ¡†æ¶: NestJS 11.x
- æ•°æ®åº“: PostgreSQL 15.x (å‘½ä»¤ç«¯ + äº‹ä»¶å­˜å‚¨) + MongoDB 7.x (æŸ¥è¯¢ç«¯)
- ç¼“å­˜: Redis 7.x
- äº‹ä»¶å­˜å‚¨: PostgreSQL Event Store

// API æ¥å£
- RESTful API: å‘½ä»¤æ“ä½œ (å†™æ“ä½œ)
- GraphQL: æŸ¥è¯¢æ“ä½œ (è¯»æ“ä½œ)
- WebSocket: å®æ—¶é€šä¿¡

// è®¤è¯ä¸æƒé™
- è®¤è¯: Passport.js + JWT
- æƒé™æ§åˆ¶: CASL (åŸºäºèƒ½åŠ›çš„è®¿é—®æ§åˆ¶)
- æ•°æ®éš”ç¦»: å¤šå±‚çº§æ•°æ®éš”ç¦»ç­–ç•¥
- è®¿é—®æ§åˆ¶: åŸºäºéš”ç¦»çº§åˆ«å’Œéšç§çº§åˆ«çš„ç»†ç²’åº¦è®¿é—®æ§åˆ¶
- å¤šå› å­è®¤è¯: TOTPã€çŸ­ä¿¡éªŒè¯ç 

// æ•°æ®å±‚
- ORM: MikroORM (æ”¯æŒPostgreSQL & MongoDB)
- è¿æ¥æ± : pg-pool, mongodb connection pool
- æ•°æ®è¿ç§»: MikroORM migrations
- æ•°æ®åŒæ­¥: äº‹ä»¶æŠ•å½±æœºåˆ¶
- æ•°æ®éš”ç¦»: ç§Ÿæˆ·çº§ã€ç»„ç»‡çº§ã€éƒ¨é—¨çº§ã€ç”¨æˆ·çº§éš”ç¦»

// æ¶æ„æ¨¡å¼
- CQRS: å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»
- äº‹ä»¶æº¯æº: çŠ¶æ€ç®¡ç†å’Œå®¡è®¡è¿½è¸ª
- GraphQL: çµæ´»æŸ¥è¯¢å’Œæ•°æ®è·å–
- æ•°æ®éš”ç¦»: å®Œæ•´çš„å¤šå±‚çº§æ•°æ®éš”ç¦»ç­–ç•¥
```

### å‰ç«¯æŠ€æœ¯æ ˆ

(å¾…å®š)

## **åç«¯ä»£ç ç»„ç»‡æ¶æ„åˆ’åˆ†åŸåˆ™**

### æ¨¡å—æ¶æ„è®¾è®¡åŸåˆ™

éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æ€æƒ³ï¼Œä»£ç ç›®å½•æ¶æ„åº”å½“é¦–å…ˆä½“ç°é¢†åŸŸçš„è¾¹ç•Œã€‚æ–°çš„æ¶æ„å°†ä¸šåŠ¡ç®¡ç†æ¨¡å—ä¸è®¤è¯æˆæƒæ¨¡å—åˆ†ç¦»ï¼Œç¡®ä¿èŒè´£æ¸…æ™°ã€‚

#### è®¾è®¡åŸåˆ™è¯¦è§£

**æ ¸å¿ƒåŸåˆ™**ï¼š
- **ä¸šåŠ¡é¢†åŸŸä¼˜å…ˆ**ï¼šé¦–å…ˆæŒ‰ä¸šåŠ¡é¢†åŸŸï¼ˆplatformã€tenantã€userã€organizationã€departmentï¼‰åˆ’åˆ†
- **è®¤è¯æˆæƒåˆ†ç¦»**ï¼šIAM æ¨¡å—ä¸“æ³¨äºè®¤è¯æˆæƒï¼Œä¸ç®¡ç†ä¸šåŠ¡å®ä½“
- **åˆ†å±‚æ¶æ„å…¶æ¬¡**ï¼šåœ¨æ¯ä¸ªæ¨¡å—å†…éƒ¨å†æŒ‰åˆ†å±‚æ¶æ„ç»„ç»‡
- **åŠŸèƒ½ç»„ä»¶æœ€å**ï¼šåœ¨æ¯å±‚å†…éƒ¨æŒ‰åŠŸèƒ½ç»„ä»¶ç»„ç»‡

**å‘½åè§„èŒƒ**ï¼š
- **ç®¡ç†æ¨¡å—**ï¼šä»¥ä¸šåŠ¡é¢†åŸŸåç§°å‘½åï¼ˆå¦‚ï¼šplatformã€tenantã€userã€organizationã€departmentï¼‰
- **æœåŠ¡æ¨¡å—**ï¼šä»¥æœåŠ¡ç±»å‹å‘½åï¼ˆå¦‚ï¼šiamã€sharedï¼‰
- **åˆ†å±‚ç›®å½•**ï¼šä»¥æ¶æ„å±‚åç§°å‘½åï¼ˆå¦‚ï¼šdomainã€applicationã€infrastructureã€presentationï¼‰
- **åŠŸèƒ½ç»„ä»¶**ï¼šä»¥åŠŸèƒ½ç»„ä»¶åç§°å‘½åï¼ˆå¦‚ï¼šentitiesã€use-casesã€controllersã€repositoriesï¼‰

**ä¼˜åŠ¿**ï¼š
1. **ä¸šåŠ¡å†…èšæ€§**ï¼šç›¸å…³åŠŸèƒ½èšé›†åœ¨åŒä¸€ä¸ªç®¡ç†æ¨¡å—
2. **èŒè´£è¾¹ç•Œæ¸…æ™°**ï¼šç®¡ç†æ¨¡å—è´Ÿè´£ä¸šåŠ¡é€»è¾‘ï¼ŒIAM æ¨¡å—è´Ÿè´£è®¤è¯æˆæƒ
3. **å¯ç»´æŠ¤æ€§**ï¼šä¿®æ”¹æŸä¸ªé¢†åŸŸæ—¶å½±å“èŒƒå›´å¯æ§
4. **å¯æ‰©å±•æ€§**ï¼šæ–°å¢é¢†åŸŸæ—¶ç»“æ„æ¸…æ™°
5. **å›¢é˜Ÿåä½œ**ï¼šä¸åŒå›¢é˜Ÿå¯ä»¥ä¸“æ³¨ä¸åŒé¢†åŸŸ

#### æ–°çš„æ¨¡å—æ¶æ„ç¤ºä¾‹

```
# æ–°çš„æ¨¡å—æ¶æ„ - ä¸šåŠ¡ç®¡ç†æ¨¡å—ä¸è®¤è¯æˆæƒæ¨¡å—åˆ†ç¦»

libs/core/                    # æ ¸å¿ƒä¸šåŠ¡æ¨¡å—
â”œâ”€â”€ platform/                 # å¹³å°ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/          # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/    # å¹³å°é…ç½®å®ä½“ã€ç³»ç»Ÿè®¾ç½®å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/# å¹³å°ç›¸å…³å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/  # å¹³å°é…ç½®èšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-events/# å¹³å°é…ç½®äº‹ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ repositories/# å¹³å°ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ application/     # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â””â”€â”€ presentation/    # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ tenant/                   # ç§Ÿæˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/          # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/    # ç§Ÿæˆ·å®ä½“ã€ç§Ÿæˆ·é…ç½®å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/# ç§Ÿæˆ·ç›¸å…³å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/  # ç§Ÿæˆ·èšåˆæ ¹
â”‚   â”‚   â”‚   â””â”€â”€ repositories/# ç§Ÿæˆ·ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ application/     # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â””â”€â”€ presentation/    # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ user/                     # ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼ˆç»Ÿä¸€ç®¡ç†å¹³å°ç”¨æˆ·+ç§Ÿæˆ·ç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/          # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/    # ç”¨æˆ·å®ä½“ã€ç”¨æˆ·æ¡£æ¡ˆå®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/# ç”¨æˆ·ç›¸å…³å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/  # ç”¨æˆ·èšåˆæ ¹
â”‚   â”‚   â”‚   â””â”€â”€ repositories/# ç”¨æˆ·ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ application/     # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â””â”€â”€ presentation/    # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ organization/             # ç»„ç»‡ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/          # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ application/     # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â””â”€â”€ presentation/    # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ department/               # éƒ¨é—¨ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/          # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ application/     # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â””â”€â”€ presentation/    # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â””â”€â”€ iam/                      # èº«ä»½è®¤è¯ä¸æˆæƒç®¡ç†æ¨¡å—
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ auth/            # è®¤è¯å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/      # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/ # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/# åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/# è¡¨ç°å±‚
    â”‚   â”œâ”€â”€ role/            # è§’è‰²å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/      # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/ # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/# åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/# è¡¨ç°å±‚
    â”‚   â”œâ”€â”€ permission/      # æƒé™å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/      # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/ # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/# åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/# è¡¨ç°å±‚
    â”‚   â”œâ”€â”€ session/         # ä¼šè¯å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/      # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/ # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/# åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/# è¡¨ç°å±‚
    â”‚   â””â”€â”€ audit/           # å®¡è®¡å­é¢†åŸŸ
    â”‚       â”œâ”€â”€ domain/      # é¢†åŸŸå±‚
    â”‚       â”œâ”€â”€ application/ # åº”ç”¨å±‚
    â”‚       â”œâ”€â”€ infrastructure/# åŸºç¡€è®¾æ–½å±‚
    â”‚       â””â”€â”€ presentation/# è¡¨ç°å±‚
    â”œâ”€â”€ package.json
    â””â”€â”€ tsconfig.json

libs/shared/                  # å…±äº«åŸºç¡€è®¾æ–½æ¨¡å—
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/              # å…±äº«é¢†åŸŸç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ entities/        # åŸºç¡€å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ value-objects/   # é€šç”¨å€¼å¯¹è±¡
â”‚   â”‚   â””â”€â”€ enums/           # é€šç”¨æšä¸¾
â”‚   â”œâ”€â”€ infrastructure/      # å…±äº«åŸºç¡€è®¾æ–½
â”‚   â””â”€â”€ presentation/        # å…±äº«è¡¨ç°å±‚ç»„ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```
```

#### åº”ç”¨ç¤ºä¾‹

**æ­£ç¡®ç¤ºä¾‹**ï¼š
- âœ… `libs/core/iam/src/auth/infrastructure/jwt.service.ts` - IAMè®¤è¯å­é¢†åŸŸçš„åŸºç¡€è®¾æ–½æœåŠ¡
- âœ… `libs/core/platform/src/domain/entities/platform-config.entity.ts` - å¹³å°ç®¡ç†æ¨¡å—çš„é¢†åŸŸå®ä½“
- âœ… `libs/core/tenant/src/domain/entities/tenant.entity.ts` - ç§Ÿæˆ·ç®¡ç†æ¨¡å—çš„é¢†åŸŸå®ä½“
- âœ… `libs/core/user/src/domain/entities/user.entity.ts` - ç”¨æˆ·ç®¡ç†æ¨¡å—çš„é¢†åŸŸå®ä½“
- âœ… `libs/core/iam/src/role/application/use-cases/create-role.usecase.ts` - IAMè§’è‰²å­é¢†åŸŸçš„åº”ç”¨ç”¨ä¾‹

**é”™è¯¯ç¤ºä¾‹**ï¼š
- âŒ `libs/core/iam/src/infrastructure/auth/jwt.service.ts` - æŒ‰åˆ†å±‚æ¶æ„ç»„ç»‡ï¼Œä¸ç¬¦åˆDDDåŸåˆ™
- âŒ `libs/core/iam/src/domain/user/user.entity.ts` - ç”¨æˆ·å®ä½“ä¸åº”æ”¾åœ¨IAMæ¨¡å—ä¸­
- âŒ `libs/core/iam/src/platform/domain/entities/platform-user.entity.ts` - å¹³å°ç”¨æˆ·å®ä½“ä¸åº”æ”¾åœ¨IAMæ¨¡å—ä¸­

### å®Œæ•´ç›®å½•ç»“æ„ç¤ºä¾‹

éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æ€æƒ³ï¼Œä»£ç ç›®å½•æ¶æ„åº”å½“é¦–å…ˆä½“ç°é¢†åŸŸçš„è¾¹ç•Œã€‚æ–°çš„æ¶æ„å°†ä¸šåŠ¡ç®¡ç†æ¨¡å—ä¸è®¤è¯æˆæƒæ¨¡å—åˆ†ç¦»ï¼Œç¡®ä¿èŒè´£æ¸…æ™°ã€‚ç¤ºä¾‹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
apps/api # apiåº”ç”¨

libs/core/                    # æ ¸å¿ƒä¸šåŠ¡æ¨¡å—
â”œâ”€â”€ platform/                 # å¹³å°ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/          # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/    # å®ä½“ (ä¸šåŠ¡å®ä½“)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ platform-config.entity.ts # å¹³å°é…ç½®å®ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ platform-system-setting.entity.ts # ç³»ç»Ÿè®¾ç½®å®ä½“
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ platform-public-data.entity.ts # å…¬å…±æ•°æ®å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/ # å€¼å¯¹è±¡ (ä¸å¯å˜å¯¹è±¡)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ platform-config-key.vo.ts # å¹³å°é…ç½®é”®å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ platform-config-value.vo.ts # å¹³å°é…ç½®å€¼å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/  # èšåˆæ ¹ (ä¸šåŠ¡è§„åˆ™ã€ä¸€è‡´æ€§è¾¹ç•Œ)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ platform-config.aggregate.ts # å¹³å°é…ç½®èšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-events/ # é¢†åŸŸäº‹ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ platform-config-updated.event.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-services/ # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/   # é¢†åŸŸå¼‚å¸¸
â”‚   â”‚   â”‚   â”œâ”€â”€ enums/        # æšä¸¾
â”‚   â”‚   â”‚   â””â”€â”€ types/        # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ application/      # åº”ç”¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ use-cases/    # ç”¨ä¾‹ (ä¸šåŠ¡é€»è¾‘å…¥å£)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ update-platform-config.usecase.ts # æ›´æ–°å¹³å°é…ç½®ç”¨ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ commands/     # å‘½ä»¤ (å†™æ“ä½œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/ # å‘½ä»¤éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ queries/      # æŸ¥è¯¢ (è¯»æ“ä½œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/ # æŸ¥è¯¢éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ projections/  # è¯»æ¨¡å‹æŠ•å½±
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ interfaces/   # åº”ç”¨å±‚æ¥å£
â”‚   â”‚   â”œâ”€â”€ infrastructure/   # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ mappers/      # æ˜ å°„å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/     # ORMå®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # åŸºç¡€è®¾æ–½æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ external/     # å¤–éƒ¨æœåŠ¡é›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ config/       # é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ migrations/   # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ presentation/     # è¡¨ç°å±‚
â”‚   â”‚       â”œâ”€â”€ controllers/  # æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ dtos/         # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ validators/   # è¡¨ç°å±‚éªŒè¯å™¨
â”‚   â”‚       â”œâ”€â”€ guards/       # æƒé™å®ˆå«
â”‚   â”‚       â””â”€â”€ interceptors/ # æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json

â”œâ”€â”€ tenant/                    # ç§Ÿæˆ·ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/           # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/     # å®ä½“ (ä¸šåŠ¡å®ä½“)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant.entity.ts # ç§Ÿæˆ·å®ä½“
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tenant-config.entity.ts # ç§Ÿæˆ·é…ç½®å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/ # å€¼å¯¹è±¡ (ä¸å¯å˜å¯¹è±¡)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant-id.vo.ts # ç§Ÿæˆ·IDå€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant-domain.vo.ts # ç§Ÿæˆ·åŸŸåå€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tenant-name.vo.ts # ç§Ÿæˆ·åç§°å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/   # èšåˆæ ¹ (ä¸šåŠ¡è§„åˆ™ã€ä¸€è‡´æ€§è¾¹ç•Œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant.aggregate.ts # ç§Ÿæˆ·èšåˆæ ¹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tenant-config.aggregate.ts # ç§Ÿæˆ·é…ç½®èšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-events/ # é¢†åŸŸäº‹ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant-created.event.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tenant-activated.event.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tenant-config-updated.event.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-services/ # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/   # é¢†åŸŸå¼‚å¸¸
â”‚   â”‚   â”‚   â”œâ”€â”€ enums/        # æšä¸¾
â”‚   â”‚   â”‚   â””â”€â”€ types/        # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ application/      # åº”ç”¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ use-cases/    # ç”¨ä¾‹ (ä¸šåŠ¡é€»è¾‘å…¥å£)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-tenant.usecase.ts # åˆ›å»ºç§Ÿæˆ·ç”¨ä¾‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activate-tenant.usecase.ts # æ¿€æ´»ç§Ÿæˆ·ç”¨ä¾‹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ update-tenant-config.usecase.ts # æ›´æ–°ç§Ÿæˆ·é…ç½®ç”¨ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ commands/     # å‘½ä»¤ (å†™æ“ä½œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/ # å‘½ä»¤éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ queries/      # æŸ¥è¯¢ (è¯»æ“ä½œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/ # æŸ¥è¯¢éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ projections/  # è¯»æ¨¡å‹æŠ•å½±
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ interfaces/   # åº”ç”¨å±‚æ¥å£
â”‚   â”‚   â”œâ”€â”€ infrastructure/   # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ mappers/      # æ˜ å°„å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/     # ORMå®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # åŸºç¡€è®¾æ–½æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ external/     # å¤–éƒ¨æœåŠ¡é›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ config/       # é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ migrations/   # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ presentation/     # è¡¨ç°å±‚
â”‚   â”‚       â”œâ”€â”€ controllers/  # æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ dtos/         # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ validators/   # è¡¨ç°å±‚éªŒè¯å™¨
â”‚   â”‚       â”œâ”€â”€ guards/       # æƒé™å®ˆå«
â”‚   â”‚       â””â”€â”€ interceptors/ # æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json

â”œâ”€â”€ user/                      # ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼ˆç»Ÿä¸€ç®¡ç†å¹³å°ç”¨æˆ·+ç§Ÿæˆ·ç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/           # é¢†åŸŸå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/     # å®ä½“ (ä¸šåŠ¡å®ä½“)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.entity.ts # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user-profile.entity.ts # ç”¨æˆ·æ¡£æ¡ˆå®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ value-objects/ # å€¼å¯¹è±¡ (ä¸å¯å˜å¯¹è±¡)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user-id.vo.ts # ç”¨æˆ·IDå€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ username.vo.ts # ç”¨æˆ·åå­—å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ email.vo.ts # é‚®ç®±å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ password.vo.ts # å¯†ç å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ aggregates/   # èšåˆæ ¹ (ä¸šåŠ¡è§„åˆ™ã€ä¸€è‡´æ€§è¾¹ç•Œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.aggregate.ts # ç”¨æˆ·èšåˆæ ¹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user-profile.aggregate.ts # ç”¨æˆ·æ¡£æ¡ˆèšåˆæ ¹
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-events/ # é¢†åŸŸäº‹ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user-created.event.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user-activated.event.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user-profile-updated.event.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ domain-services/ # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/   # é¢†åŸŸå¼‚å¸¸
â”‚   â”‚   â”‚   â”œâ”€â”€ enums/        # æšä¸¾
â”‚   â”‚   â”‚   â””â”€â”€ types/        # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ application/      # åº”ç”¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ use-cases/    # ç”¨ä¾‹ (ä¸šåŠ¡é€»è¾‘å…¥å£)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-user.usecase.ts # åˆ›å»ºç”¨æˆ·ç”¨ä¾‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ activate-user.usecase.ts # æ¿€æ´»ç”¨æˆ·ç”¨ä¾‹
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ update-user-profile.usecase.ts # æ›´æ–°ç”¨æˆ·æ¡£æ¡ˆç”¨ä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ commands/     # å‘½ä»¤ (å†™æ“ä½œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/ # å‘½ä»¤éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ queries/      # æŸ¥è¯¢ (è¯»æ“ä½œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # æŸ¥è¯¢å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validators/ # æŸ¥è¯¢éªŒè¯å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ projections/  # è¯»æ¨¡å‹æŠ•å½±
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ interfaces/   # åº”ç”¨å±‚æ¥å£
â”‚   â”‚   â”œâ”€â”€ infrastructure/   # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ mappers/      # æ˜ å°„å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/     # ORMå®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ services/     # åŸºç¡€è®¾æ–½æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ external/     # å¤–éƒ¨æœåŠ¡é›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ config/       # é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ migrations/   # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ presentation/     # è¡¨ç°å±‚
â”‚   â”‚       â”œâ”€â”€ controllers/  # æ§åˆ¶å™¨
â”‚   â”‚       â”œâ”€â”€ dtos/         # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ validators/   # è¡¨ç°å±‚éªŒè¯å™¨
â”‚   â”‚       â”œâ”€â”€ guards/       # æƒé™å®ˆå«
â”‚   â”‚       â””â”€â”€ interceptors/ # æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json

â”œâ”€â”€ organization/              # ç»„ç»‡ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/           # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ application/          # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ infrastructure/       # åŸºç¡€è®¾æ–½å±‚
â”‚   â””â”€â”€ presentation/         # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json

â”œâ”€â”€ department/                # éƒ¨é—¨ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ domain/           # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ application/          # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ infrastructure/       # åŸºç¡€è®¾æ–½å±‚
â”‚   â””â”€â”€ presentation/         # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json

â””â”€â”€ iam/                       # èº«ä»½è®¤è¯ä¸æˆæƒç®¡ç†æ¨¡å—
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ auth/             # è®¤è¯å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/       # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/  # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/ # è¡¨ç°å±‚
    â”‚   â”œâ”€â”€ role/             # è§’è‰²å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/       # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/  # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/ # è¡¨ç°å±‚
    â”‚   â”œâ”€â”€ permission/       # æƒé™å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/       # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/  # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/ # è¡¨ç°å±‚
    â”‚   â”œâ”€â”€ session/          # ä¼šè¯å­é¢†åŸŸ
    â”‚   â”‚   â”œâ”€â”€ domain/       # é¢†åŸŸå±‚
    â”‚   â”‚   â”œâ”€â”€ application/  # åº”ç”¨å±‚
    â”‚   â”‚   â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚
    â”‚   â”‚   â””â”€â”€ presentation/ # è¡¨ç°å±‚
    â”‚   â””â”€â”€ audit/            # å®¡è®¡å­é¢†åŸŸ
    â”‚       â”œâ”€â”€ domain/       # é¢†åŸŸå±‚
    â”‚       â”œâ”€â”€ application/  # åº”ç”¨å±‚
    â”‚       â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚
    â”‚       â””â”€â”€ presentation/ # è¡¨ç°å±‚
    â”œâ”€â”€ package.json
    â””â”€â”€ tsconfig.json

libs/shared/                   # å…±äº«åŸºç¡€è®¾æ–½æ¨¡å—
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ domain/               # å…±äº«é¢†åŸŸç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ entities/         # åŸºç¡€å®ä½“ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ platform-aware.entity.ts # å¹³å°æ„ŸçŸ¥å®ä½“åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ data-isolation-aware.entity.ts # æ•°æ®éš”ç¦»æ„ŸçŸ¥å®ä½“åŸºç±»
â”‚   â”‚   â”‚   â””â”€â”€ user-profile.entity.ts # ç”¨æˆ·æ¡£æ¡ˆå®ä½“
â”‚   â”‚   â”œâ”€â”€ value-objects/    # é€šç”¨å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ uuid.vo.ts    # UUIDå€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ email.vo.ts   # é‚®ç®±å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â””â”€â”€ password.vo.ts # å¯†ç å€¼å¯¹è±¡
â”‚   â”‚   â””â”€â”€ enums/            # é€šç”¨æšä¸¾
â”‚   â”‚       â”œâ”€â”€ data-privacy-level.enum.ts # æ•°æ®éšç§çº§åˆ«æšä¸¾
â”‚   â”‚       â””â”€â”€ data-isolation-level.enum.ts # æ•°æ®éš”ç¦»çº§åˆ«æšä¸¾
â”‚   â”œâ”€â”€ infrastructure/       # å…±äº«åŸºç¡€è®¾æ–½
â”‚   â””â”€â”€ presentation/         # å…±äº«è¡¨ç°å±‚ç»„ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

## ğŸ§ª **æµ‹è¯•ä»£ç ç»„ç»‡æ¶æ„**

### æµ‹è¯•åˆ†å±‚ç­–ç•¥

éµå¾ª Clean Architecture çš„åˆ†å±‚åŸåˆ™å’Œ monorepo çš„æœ€ä½³å®è·µï¼Œæµ‹è¯•ä»£ç åº”å½“æŒ‰ç…§å¯¹åº”çš„æ¶æ„å±‚è¿›è¡Œç»„ç»‡ï¼Œç¡®ä¿æµ‹è¯•è¦†ç›–çš„å®Œæ•´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

```
æµ‹è¯•ä»£ç ç»„ç»‡æ¶æ„
â”œâ”€â”€ å•å…ƒæµ‹è¯• (Unit Tests) - ä¸è¢«æµ‹è¯•ä»£ç åŒçº§ç›®å½•
â”‚   â”œâ”€â”€ domain/ # é¢†åŸŸå±‚æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.entity.spec.ts # ä¸å®ä½“æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ value-objects/
â”‚   â”‚   â”‚   â”œâ”€â”€ email.value-object.ts
â”‚   â”‚   â”‚   â””â”€â”€ email.value-object.spec.ts # ä¸å€¼å¯¹è±¡æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ aggregates/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.aggregate.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.aggregate.spec.ts # ä¸èšåˆæ ¹æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ domain-services/
â”‚   â”‚   â”‚   â”œâ”€â”€ user-domain.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ user-domain.service.spec.ts # ä¸é¢†åŸŸæœåŠ¡æ–‡ä»¶åŒçº§
â”‚   â”‚   â””â”€â”€ domain-events/
â”‚   â”‚       â”œâ”€â”€ user-created.event.ts
â”‚   â”‚       â””â”€â”€ user-created.event.spec.ts # ä¸äº‹ä»¶æ–‡ä»¶åŒçº§
â”‚   â”œâ”€â”€ application/ # åº”ç”¨å±‚æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ use-cases/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-user.usecase.ts
â”‚   â”‚   â”‚   â””â”€â”€ create-user.usecase.spec.ts # ä¸ç”¨ä¾‹æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-user.command.ts
â”‚   â”‚   â”‚   â””â”€â”€ create-user.command.spec.ts # ä¸å‘½ä»¤æ–‡ä»¶åŒçº§
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ create-user.handler.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ create-user.handler.spec.ts # ä¸å‘½ä»¤å¤„ç†å™¨æ–‡ä»¶åŒçº§
â”‚   â”‚   â”‚   â””â”€â”€ validators/
â”‚   â”‚   â”‚     â”œâ”€â”€ create-user.validator.ts
â”‚   â”‚   â”‚     â””â”€â”€ create-user.validator.spec.ts # ä¸å‘½ä»¤éªŒè¯å™¨æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ queries/
â”‚   â”‚   â”‚   â”œâ”€â”€ get-user.query.ts
â”‚   â”‚   â”‚   â””â”€â”€ get-user.query.spec.ts # ä¸æŸ¥è¯¢æ–‡ä»¶åŒçº§
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ get-user.handler.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ get-user.handler.spec.ts # ä¸æŸ¥è¯¢å¤„ç†å™¨æ–‡ä»¶åŒçº§
â”‚   â”‚   â”‚   â””â”€â”€ validators/
â”‚   â”‚   â”‚     â”œâ”€â”€ get-user.validator.ts
â”‚   â”‚   â”‚     â””â”€â”€ get-user.validator.spec.ts # ä¸æŸ¥è¯¢éªŒè¯å™¨æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ projections/
â”‚   â”‚   â”‚   â”œâ”€â”€ user-read-model.projection.ts
â”‚   â”‚   â”‚   â””â”€â”€ user-read-model.projection.spec.ts # ä¸æŠ•å½±æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.service.spec.ts # ä¸åº”ç”¨æœåŠ¡æ–‡ä»¶åŒçº§
â”‚   â”‚   â””â”€â”€ interfaces/
â”‚   â”‚       â”œâ”€â”€ user.interface.ts
â”‚   â”‚       â””â”€â”€ user.interface.spec.ts # ä¸æ¥å£æ–‡ä»¶åŒçº§
â”‚   â”œâ”€â”€ infrastructure/ # åŸºç¡€è®¾æ–½å±‚æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.repository.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.repository.spec.ts # ä¸ä»“å‚¨æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ mappers/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.mapper.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.mapper.spec.ts # ä¸æ˜ å°„å™¨æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ user.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ user.entity.spec.ts # ä¸ORMå®ä½“æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ email.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ email.service.spec.ts # ä¸åŸºç¡€è®¾æ–½æœåŠ¡æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ external/
â”‚   â”‚   â”‚   â”œâ”€â”€ payment.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ payment.service.spec.ts # ä¸å¤–éƒ¨æœåŠ¡æ–‡ä»¶åŒçº§
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ database.config.ts
â”‚   â”‚   â”‚   â””â”€â”€ database.config.spec.ts # ä¸é…ç½®æ–‡ä»¶åŒçº§
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”‚       â”œâ”€â”€ create-users.migration.ts
â”‚   â”‚       â””â”€â”€ create-users.migration.spec.ts # ä¸è¿ç§»æ–‡ä»¶åŒçº§
â”‚   â””â”€â”€ presentation/ # è¡¨ç°å±‚æµ‹è¯•
â”‚       â”œâ”€â”€ controllers/
â”‚       â”‚   â”œâ”€â”€ user.controller.ts
â”‚       â”‚   â””â”€â”€ user.controller.spec.ts # ä¸æ§åˆ¶å™¨æ–‡ä»¶åŒçº§
â”‚       â”œâ”€â”€ dtos/
â”‚       â”‚   â”œâ”€â”€ create-user.dto.ts
â”‚       â”‚   â””â”€â”€ create-user.dto.spec.ts # ä¸DTOæ–‡ä»¶åŒçº§
â”‚       â”œâ”€â”€ validators/
â”‚       â”‚   â”œâ”€â”€ create-user.validator.ts
â”‚       â”‚   â””â”€â”€ create-user.validator.spec.ts # ä¸éªŒè¯å™¨æ–‡ä»¶åŒçº§
â”‚       â”œâ”€â”€ guards/
â”‚       â”‚   â”œâ”€â”€ auth.guard.ts
â”‚       â”‚   â””â”€â”€ auth.guard.spec.ts # ä¸å®ˆå«æ–‡ä»¶åŒçº§
â”‚       â””â”€â”€ interceptors/
â”‚           â”œâ”€â”€ logging.interceptor.ts
â”‚           â””â”€â”€ logging.interceptor.spec.ts # ä¸æ‹¦æˆªå™¨æ–‡ä»¶åŒçº§
â”œâ”€â”€ é›†æˆæµ‹è¯• (Integration Tests) - ç‹¬ç«‹ç›®å½•
â”‚   â”œâ”€â”€ api/ # APIé›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ user-api.integration.spec.ts
â”‚   â”‚   â””â”€â”€ auth-api.integration.spec.ts
â”‚   â”œâ”€â”€ database/ # æ•°æ®åº“é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ user-database.integration.spec.ts
â”‚   â”‚   â””â”€â”€ transaction.integration.spec.ts
â”‚   â”œâ”€â”€ external-services/ # å¤–éƒ¨æœåŠ¡é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ payment-service.integration.spec.ts
â”‚   â”‚   â””â”€â”€ email-service.integration.spec.ts
â”‚   â””â”€â”€ event-sourcing/ # äº‹ä»¶æº¯æºé›†æˆæµ‹è¯•
â”‚       â”œâ”€â”€ user-events.integration.spec.ts
â”‚       â”œâ”€â”€ event-store.integration.spec.ts
â”‚       â””â”€â”€ projections.integration.spec.ts
â”œâ”€â”€ ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests) - ç‹¬ç«‹ç›®å½•
â”‚   â”œâ”€â”€ scenarios/ # ä¸šåŠ¡åœºæ™¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ user-registration.e2e.spec.ts
â”‚   â”‚   â””â”€â”€ user-authentication.e2e.spec.ts
â”‚   â”œâ”€â”€ workflows/ # å·¥ä½œæµæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ user-onboarding.e2e.spec.ts
â”‚   â”‚   â””â”€â”€ password-reset.e2e.spec.ts
â”‚   â””â”€â”€ user-journeys/ # ç”¨æˆ·æ—…ç¨‹æµ‹è¯•
â”‚       â”œâ”€â”€ complete-user-flow.e2e.spec.ts
â”‚       â””â”€â”€ admin-dashboard.e2e.spec.ts
â””â”€â”€ æ€§èƒ½æµ‹è¯• (Performance Tests) - ç‹¬ç«‹ç›®å½•
    â”œâ”€â”€ load/ # è´Ÿè½½æµ‹è¯•
    â”‚   â”œâ”€â”€ user-api.load.spec.ts
    â”‚   â””â”€â”€ database.load.spec.ts
    â”œâ”€â”€ stress/ # å‹åŠ›æµ‹è¯•
    â”‚   â”œâ”€â”€ user-api.stress.spec.ts
    â”‚   â””â”€â”€ concurrent-users.stress.spec.ts
    â””â”€â”€ benchmark/ # åŸºå‡†æµ‹è¯•
        â”œâ”€â”€ query-performance.benchmark.spec.ts
        â””â”€â”€ memory-usage.benchmark.spec.ts
```

### æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ

æµ‹è¯•æ–‡ä»¶å‘½ååº”å½“ä¸è¢«æµ‹è¯•æ–‡ä»¶ä¿æŒä¸€è‡´ï¼Œå¹¶æ·»åŠ ç›¸åº”çš„åç¼€ã€‚

```
æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ
â”œâ”€â”€ å•å…ƒæµ‹è¯•: *.spec.ts (ä¸è¢«æµ‹è¯•æ–‡ä»¶åŒçº§ç›®å½•)
â”‚   â”œâ”€â”€ user.entity.ts â†’ user.entity.spec.ts # å®ä½“æµ‹è¯•
â”‚   â”œâ”€â”€ create-user.usecase.ts â†’ create-user.usecase.spec.ts # ç”¨ä¾‹æµ‹è¯•
â”‚   â”œâ”€â”€ user.repository.ts â†’ user.repository.spec.ts # ä»“å‚¨æµ‹è¯•
â”‚   â”œâ”€â”€ user.service.ts â†’ user.service.spec.ts # æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ user.controller.ts â†’ user.controller.spec.ts # æ§åˆ¶å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ auth.guard.ts â†’ auth.guard.spec.ts # å®ˆå«æµ‹è¯•
â”‚   â””â”€â”€ logging.interceptor.ts â†’ logging.interceptor.spec.ts # æ‹¦æˆªå™¨æµ‹è¯•
â”œâ”€â”€ é›†æˆæµ‹è¯•: *.integration.spec.ts (ç‹¬ç«‹ç›®å½•)
â”‚   â”œâ”€â”€ user-api.integration.spec.ts # APIé›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ user-database.integration.spec.ts # æ•°æ®åº“é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ user-events.integration.spec.ts # äº‹ä»¶æº¯æºé›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ projections.integration.spec.ts # æŠ•å½±é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ payment-service.integration.spec.ts # å¤–éƒ¨æœåŠ¡é›†æˆæµ‹è¯•
â”œâ”€â”€ ç«¯åˆ°ç«¯æµ‹è¯•: *.e2e.spec.ts (ç‹¬ç«‹ç›®å½•)
â”‚   â”œâ”€â”€ user-registration.e2e.spec.ts # ç”¨æˆ·æ³¨å†ŒE2Eæµ‹è¯•
â”‚   â”œâ”€â”€ user-authentication.e2e.spec.ts # ç”¨æˆ·è®¤è¯E2Eæµ‹è¯•
â”‚   â”œâ”€â”€ user-workflow.e2e.spec.ts # ç”¨æˆ·å·¥ä½œæµE2Eæµ‹è¯•
â”‚   â””â”€â”€ admin-dashboard.e2e.spec.ts # ç®¡ç†é¢æ¿E2Eæµ‹è¯•
â””â”€â”€ æ€§èƒ½æµ‹è¯•: *.performance.spec.ts (ç‹¬ç«‹ç›®å½•)
    â”œâ”€â”€ user-api.performance.spec.ts # APIæ€§èƒ½æµ‹è¯•
    â”œâ”€â”€ database-query.performance.spec.ts # æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
    â”œâ”€â”€ memory-usage.performance.spec.ts # å†…å­˜ä½¿ç”¨æ€§èƒ½æµ‹è¯•
    â””â”€â”€ concurrent-users.performance.spec.ts # å¹¶å‘ç”¨æˆ·æ€§èƒ½æµ‹è¯•
```

### æµ‹è¯•æ•°æ®ç®¡ç†

```
æµ‹è¯•æ•°æ®ç®¡ç†ç­–ç•¥
â”œâ”€â”€ fixtures/ # æµ‹è¯•æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ users/ # ç”¨æˆ·æµ‹è¯•æ•°æ®
â”‚   â”‚   â”œâ”€â”€ valid-users.json # æœ‰æ•ˆç”¨æˆ·æ•°æ®
â”‚   â”‚   â”œâ”€â”€ invalid-users.json # æ— æ•ˆç”¨æˆ·æ•°æ®
â”‚   â”‚   â””â”€â”€ edge-cases.json # è¾¹ç•Œæƒ…å†µæ•°æ®
â”‚   â”œâ”€â”€ organizations/ # ç»„ç»‡æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ permissions/ # æƒé™æµ‹è¯•æ•°æ®
â”œâ”€â”€ factories/ # æµ‹è¯•æ•°æ®å·¥å‚
â”‚   â”œâ”€â”€ user.factory.ts # ç”¨æˆ·å·¥å‚
â”‚   â”œâ”€â”€ organization.factory.ts # ç»„ç»‡å·¥å‚
â”‚   â””â”€â”€ permission.factory.ts # æƒé™å·¥å‚
â”œâ”€â”€ mocks/ # æ¨¡æ‹Ÿå¯¹è±¡
â”‚   â”œâ”€â”€ repositories/ # ä»“å‚¨æ¨¡æ‹Ÿ
â”‚   â”œâ”€â”€ services/ # æœåŠ¡æ¨¡æ‹Ÿ
â”‚   â””â”€â”€ external/ # å¤–éƒ¨æœåŠ¡æ¨¡æ‹Ÿ
â””â”€â”€ helpers/ # æµ‹è¯•è¾…åŠ©å·¥å…·
    â”œâ”€â”€ test-database.helper.ts # æµ‹è¯•æ•°æ®åº“åŠ©æ‰‹
    â”œâ”€â”€ test-events.helper.ts # æµ‹è¯•äº‹ä»¶åŠ©æ‰‹
    â””â”€â”€ test-auth.helper.ts # æµ‹è¯•è®¤è¯åŠ©æ‰‹
```

### æµ‹è¯•é…ç½®ç®¡ç†

```
æµ‹è¯•é…ç½®ç®¡ç†
â”œâ”€â”€ jest.config.ts # Jestä¸»é…ç½®
â”œâ”€â”€ jest-unit.config.ts # å•å…ƒæµ‹è¯•é…ç½®
â”œâ”€â”€ jest-integration.config.ts # é›†æˆæµ‹è¯•é…ç½®
â”œâ”€â”€ jest-e2e.config.ts # E2Eæµ‹è¯•é…ç½®
â”œâ”€â”€ jest-performance.config.ts # æ€§èƒ½æµ‹è¯•é…ç½®
â”œâ”€â”€ test-environment/ # æµ‹è¯•ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ test-database.config.ts # æµ‹è¯•æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ test-redis.config.ts # æµ‹è¯•Redisé…ç½®
â”‚   â””â”€â”€ test-postgresql.config.ts # æµ‹è¯•PostgreSQLé…ç½®
â””â”€â”€ coverage/ # æµ‹è¯•è¦†ç›–ç‡é…ç½®
    â”œâ”€â”€ coverage.config.ts # è¦†ç›–ç‡é…ç½®
    â””â”€â”€ thresholds/ # è¦†ç›–ç‡é˜ˆå€¼
        â”œâ”€â”€ unit.threshold.ts # å•å…ƒæµ‹è¯•é˜ˆå€¼
        â”œâ”€â”€ integration.threshold.ts # é›†æˆæµ‹è¯•é˜ˆå€¼
        â””â”€â”€ e2e.threshold.ts # E2Eæµ‹è¯•é˜ˆå€¼
```

### æµ‹è¯•æ‰§è¡Œç­–ç•¥

```
æµ‹è¯•æ‰§è¡Œç­–ç•¥
â”œâ”€â”€ å¼€å‘é˜¶æ®µæµ‹è¯•
â”‚   â”œâ”€â”€ å•å…ƒæµ‹è¯•: pnpm test --watch # ç›‘å¬æ¨¡å¼
â”‚   â”œâ”€â”€ å¿«é€Ÿé›†æˆæµ‹è¯•: pnpm test --testPathPattern=integration
â”‚   â””â”€â”€ ä»£ç è¦†ç›–ç‡: pnpm test --coverage
â”œâ”€â”€ æäº¤å‰æµ‹è¯•
â”‚   â”œâ”€â”€ å…¨é‡å•å…ƒæµ‹è¯•: pnpm test
â”‚   â”œâ”€â”€ å…³é”®é›†æˆæµ‹è¯•: pnpm test --testPathPattern=critical
â”‚   â””â”€â”€ ä»£ç è´¨é‡æ£€æŸ¥: pnpm lint && pnpm test --coverage
â”œâ”€â”€ æŒç»­é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ å…¨é‡æµ‹è¯•å¥—ä»¶: pnpm run-many --target=test --all
â”‚   â”œâ”€â”€ å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ: pnpm run-many --target=test --parallel=4
â”‚   â””â”€â”€ æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ: pnpm test --coverage --reporter=html
â””â”€â”€ ç”Ÿäº§å‰æµ‹è¯•
    â”œâ”€â”€ ç«¯åˆ°ç«¯æµ‹è¯•: pnpm e2e
    â”œâ”€â”€ æ€§èƒ½æµ‹è¯•: pnpm performance
    â””â”€â”€ å®‰å…¨æµ‹è¯•: pnpm security-test
```

### æµ‹è¯•æœ€ä½³å®è·µ

```
æµ‹è¯•æœ€ä½³å®è·µ
â”œâ”€â”€ æµ‹è¯•åŸåˆ™
â”‚   â”œâ”€â”€ å•ä¸€èŒè´£: æ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªåŠŸèƒ½ç‚¹
â”‚   â”œâ”€â”€ ç‹¬ç«‹æ€§: æµ‹è¯•ä¹‹é—´ä¸åº”ç›¸äº’ä¾èµ–
â”‚   â”œâ”€â”€ å¯é‡å¤æ€§: æµ‹è¯•ç»“æœåº”ä¿æŒä¸€è‡´
â”‚   â””â”€â”€ å¿«é€Ÿæ‰§è¡Œ: å•å…ƒæµ‹è¯•åº”åœ¨æ¯«ç§’çº§å®Œæˆ
â”œâ”€â”€ æµ‹è¯•æ¨¡å¼
â”‚   â”œâ”€â”€ AAAæ¨¡å¼: Arrange-Act-Assert
â”‚   â”œâ”€â”€ Given-When-Then: è¡Œä¸ºé©±åŠ¨å¼€å‘
â”‚   â”œâ”€â”€ æµ‹è¯•æ›¿èº«: Mockã€Stubã€Spyã€Fake
â”‚   â””â”€â”€ æµ‹è¯•æ•°æ®æ„å»ºå™¨: Builder Pattern
â”œâ”€â”€ æµ‹è¯•è¦†ç›–ç­–ç•¥
â”‚   â”œâ”€â”€ ä»£ç è¦†ç›–ç‡: å•å…ƒæµ‹è¯• > 80%
â”‚   â”œâ”€â”€ åˆ†æ”¯è¦†ç›–ç‡: å…³é”®åˆ†æ”¯ > 90%
â”‚   â”œâ”€â”€ è·¯å¾„è¦†ç›–ç‡: å¤æ‚é€»è¾‘ > 95%
â”‚   â””â”€â”€ é›†æˆè¦†ç›–ç‡: å…³é”®æµç¨‹ > 70%
â””â”€â”€ æµ‹è¯•ç»´æŠ¤
    â”œâ”€â”€ æµ‹è¯•é‡æ„: ä¿æŒæµ‹è¯•ä»£ç æ•´æ´
    â”œâ”€â”€ æµ‹è¯•æ–‡æ¡£: æ¸…æ™°çš„æµ‹è¯•æè¿°
    â”œâ”€â”€ æµ‹è¯•å®¡æŸ¥: ä»£ç å®¡æŸ¥åŒ…å«æµ‹è¯•
    â””â”€â”€ æµ‹è¯•ç›‘æ§: æŒç»­ç›‘æ§æµ‹è¯•è´¨é‡
```

```

```
